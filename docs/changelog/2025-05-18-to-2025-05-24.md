# 开发日志：2025年5月18日 - 2025年5月24日

## WebUI 开发

### 完成的任务
1. **功能实现**：
   - 实现了 WebUI 的基本功能，包括数据集的可视化和管理。
   - 添加了用户友好的界面，支持数据集的上传、下载和预览。

2. **错误修复**：
   - 修复了多个前端显示问题。
   - 优化了后端 API 的性能。

3. **测试**：
   - 编写了单元测试和集成测试，确保 WebUI 的稳定性。

### 遇到的问题
- 部分 API 的响应时间较长，后续需要进一步优化。
- 用户权限管理功能尚未完全实现。

---

# 开发日志：2025年5月25日 - 2025年5月31日

## Crawler 类调试与修复

### 完成的任务
1. **初步调试**：
   - 针对多个数据源（如 `Danbooru`、`Zerochan`、`Safebooru` 等）运行了集成测试。
   - 发现以下主要问题：
     - 部分数据源无返回结果。
     - 参数映射错误（如 `select` 和 `min_size`）。
     - HTTP 错误（如 `403 Forbidden`、`404 Not Found`）。
     - 网络问题和重试失败（如 `Lolibooru`）。

2. **Crawler 类修复**：
   - 更新了 `start_crawl` 方法：
     - 将 `min_size` 映射为下载限制，将 `select` 映射为图片大小。
     - 为 HTTP、连接、超时和网络错误添加了错误处理。
     - 确保不支持的源返回明确的错误信息。
   - 调整了 `source_mapping`，仅将 `select` 参数传递给支持的源（如 `Zerochan`、`WallHaven`、`Pixiv`、`Derpibooru`）。

3. **集成测试**：
   - 修复后重新运行了集成测试。
   - 减少了失败数量，但仍有部分源存在问题。

### 遇到的问题
- **`Danbooru`、`Zerochan`、`Safebooru`**：无返回结果。
- **`WallHaven`**：`Unknown image selection` 错误。
- **`Konachan`**：`403 Forbidden` 错误。
- **`Lolibooru`**：重试失败。
- **`Paheal`**：`404 Not Found` 错误。

### 下一步计划
1. 进一步调试上述问题。
2. 确保所有参数（如 `tags`、`limit`、`size`、`strict`）正确传递并与各源兼容。
3. 编写更详细的开发文档，记录调试和修复过程。
4. 重新运行集成测试，验证修复效果。

## 爬虫调试

### 初步调试
- **集成测试**：对多个数据源进行了集成测试。
  - 发现的问题包括：无结果、参数不匹配、HTTP 错误（403 Forbidden、404 Not Found）以及重试失败。

### 爬虫类更新
- **start_crawl 方法**：
  - 将 `min_size` 映射到下载限制，将 `select` 映射到图像大小。
  - 仅将 `select` 参数传递给支持的源（如 Zerochan、WallHaven、Pixiv、Derpibooru）。
  - 添加了对 HTTP、连接、超时和网络错误的处理。
  - 确保不支持的源返回明确的错误消息。
- **source_mapping 调整**：
  - 确保与每个源的参数要求兼容。

### 集成测试
- **重新运行测试**：
  - 更新后重新运行了集成测试。
  - 减少了失败的数量，但某些源仍存在问题。

### 持续调试和解决步骤

#### 持续问题
1. **无结果**：
   - **受影响的源**：Danbooru、Zerochan、Safebooru。
   - **解决方案**：调查 API 响应并调整查询参数以匹配源的要求。

2. **未知图像选择**：
   - **受影响的源**：WallHaven。
   - **解决方案**：更新 `select` 参数映射以符合 WallHaven 的 API 文档。

3. **403 Forbidden**：
   - **受影响的源**：Konachan。
   - **解决方案**：添加用户代理头并重试逻辑以处理速率限制。

4. **重试失败**：
   - **受影响的源**：Lolibooru。
   - **解决方案**：增强重试机制以包括指数退避。

5. **404 Not Found**：
   - **受影响的源**：Paheal。
   - **解决方案**：验证端点 URL 并修正错误路径。

#### 参数验证
- 确保所有参数（`tags`、`limit`、`size`、`strict`）均正确传递并与每个源兼容。

#### 集成测试验证
- 修复后重新运行测试以确认所有源均按预期工作。
